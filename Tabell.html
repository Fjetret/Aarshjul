<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Administrer Årshjulet</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 20px;
        }

        table {
            width: 60%;
            border-collapse: collapse;
            margin-bottom: 20px;
            font-size: 0.9em;
        }

        th, td {
            border: 1px solid #ddd;
            padding: 4px 6px;
            text-align: center;
        }

        th {
            background-color: #f2f2f2;
        }

        th.month {
            width: 7%;
        }

        th.type {
            width: 7%;
        }

        th.activity {
            width: 10%;
        }

        th.link {
            width: 10%;
        }

        th.move {
            width: 5%;
        }

        th.delete {
            width: 5%;
        }

        select, input {
            font-size: 0.9em;
            padding: 2px 4px;
        }

        button {
            padding: 3px 6px;
            font-size: 0.85em;
            cursor: pointer;
        }

        .add-row-container {
            margin-bottom: 10px;
        }

        .edit-button {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 0.85em;
            padding: 5px 10px;
            cursor: pointer;
            border: none;
            background-color: #4CAF50;
            color: white;
            border-radius: 4px;
        }

    </style>
</head>
<body>
    <button class="edit-button" onclick="goToYearWheel()">Årshjul</button>
    <h1>Administrer Årshjulet</h1>

    <div class="add-row-container">
        <button onclick="addRow()">Legg til rad</button>
    </div>

    <table id="adminTable">
        <thead>
            <tr>
                <th class="month">Måned</th>
                <th class="type">Type</th>
                <th class="activity">Aktiviteter</th>
                <th class="link">Link</th>
                <th class="delete">Slett</th>
            </tr>
        </thead>
        <tbody>
            <!-- Rader vil bli lagt til dynamisk -->
        </tbody>
    </table>

    <script>
        const scriptURL = 'https://script.google.com/macros/s/AKfycbxbCdUB_1VqP_RWvgQcG7y5sGjDTzXrkNIjyW5tAfS2TOEI1HnWGL8_o72-QPaJPC_1zA/exec';
        let data = [];

        // Hente data fra Google Sheets
        async function fetchData() {
            try {
                const response = await fetch(scriptURL);
                data = await response.json();
                updateTable();
            } catch (error) {
                console.error('Feil ved henting av data:', error);
            }
        }

        // Lagring av data til Google Sheets
        async function saveData() {
            try {
                await fetch(scriptURL, {
                    method: 'POST',
                    body: JSON.stringify(data),
                });
                console.log('Data lagret:', data);
            } catch (error) {
                console.error('Feil ved lagring av data:', error);
            }
        }

        function addRow() {
            data.push(['Januar', 'Vikar', '', '']);
            updateTable();
            saveData();
        }

        function updateTable() {
            const tableBody = document.querySelector('#adminTable tbody');
            tableBody.innerHTML = '';

            data.forEach((row, index) => {
                const tr = document.createElement('tr');

                tr.innerHTML = `
                    <td>
                        <select class="month">
                            ${['Januar', 'Februar', 'Mars', 'April', 'Mai', 'Juni', 'Juli', 'August', 'September', 'Oktober', 'November', 'Desember'].map(
                                month => `<option value="${month}" ${month === row[0] ? 'selected' : ''}>${month}</option>`
                            ).join('')}
                        </select>
                    </td>
                    <td>
                        <select class="type">
                            <option value="Vikar" ${row[1] === 'Vikar' ? 'selected' : ''}>Vikar</option>
                            <option value="Kunde" ${row[1] === 'Kunde' ? 'selected' : ''}>Kunde</option>
                        </select>
                    </td>
                    <td><input type="text" class="activity" value="${row[2]}"></td>
                    <td><input type="text" class="link" value="${row[3]}"></td>
                    <td><button class="deleteRow">Slett</button></td>
                `;

                tr.querySelector('.deleteRow').addEventListener('click', () => {
                    data.splice(index, 1);
                    updateTable();
                    saveData();
                });

                tr.querySelector('.month').addEventListener('change', (e) => {
                    data[index][0] = e.target.value;
                    saveData();
                });

                tr.querySelector('.type').addEventListener('change', (e) => {
                    data[index][1] = e.target.value;
                    saveData();
                });

                tr.querySelector('.activity').addEventListener('input', (e) => {
                    data[index][2] = e.target.value;
                    saveData();
                });

                tr.querySelector('.link').addEventListener('input', (e) => {
                    data[index][3] = e.target.value;
                    saveData();
                });

                tableBody.appendChild(tr);
            });
        }

        // Hente data når siden lastes
        fetchData();

        // Gå tilbake til årshjulet
        function goToYearWheel() {
            window.location.href = 'index.html';
        }
    </script>
</body>
</html>
